name: Build and Deploy to Azure App Service

on:
    push:
        branches:
            - CheckPoint5
env:
    AZURE_WEBAPP_NAME: 'CopilotTrainingStarter'
    AZURE_WEBAPP_PACKAGE_PATH: './dist/CopilotTrainingStarter'

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout
          uses: actions/checkout@v2

        - name: Setup Node.js
          uses: actions/setup-node@v2
          with:
            node-version: '16.x'

        - name: Install dependencies
          run: npm ci

        - name: Build Angular app
          run: npm run build

        - name: Deploy to Azure App Service
          uses: azure/webapps-deploy@v2
          with:
            app-name: ${{ env.AZURE_WEBAPP_NAME }}
            package: ${{ env.AZURE_WEBAPP_PACKAGE_PATH }}
            publish-profile: ${{ secrets.PUBLISH_PROFILE }}